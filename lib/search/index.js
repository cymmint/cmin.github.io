/***!
 * origin: 摘星少年个人博客。
 * createtime: 2018-09-10
 * author: cmin
 * Copyright(c) 2018 http://cmin.me/
 */
function proceedsearch(){$("body").append('<div class="popoverlay">').css({overflow:"hidden",paddingRight:"17px"}),$popup.toggle(function(){popopConH()})}function popopConH(){$popup.is(":visible")&&$popupCon.css("height",$popup.height()-48)}var isfetched=!1,$popup=$("div.popup"),$popupCon=$("#local-search-result");0==search_path.length&&(search_path="search.xml");var searchFunc=function(path,search_id,content_id){"use strict";$.ajax({url:path,dataType:"xml",async:!0,success:function(xmlResponse){isfetched=!0,$popup.detach().appendTo(".header-inner");var datas=$("entry",xmlResponse).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),$input=document.getElementById(search_id),$resultContent=document.getElementById(content_id);$input.addEventListener("input",function(){var matchcounts=0,str='<ul class="search-result-list">',keywords=this.value.trim().toLowerCase().split(/[\s\-]+/);$resultContent.innerHTML="",this.value.trim().length>1&&datas.forEach(function(data){var isMatch=!1,data_title=data.title.trim().toLowerCase(),data_content=data.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),data_url=decodeURIComponent(data.url),index_title=-1,index_content=-1,first_occur=-1;if(""!=data_title&&keywords.forEach(function(keyword,i){index_title=data_title.indexOf(keyword),index_content=data_content.indexOf(keyword),(index_title>=0||index_content>=0)&&(isMatch=!0,0==i&&(first_occur=index_content))}),isMatch){matchcounts+=1,str+="<li><a href='"+data_url+"' class='search-result-title'>"+data_title+"</a>";var content=data.content.trim().replace(/<[^>]+>/g,"");if(first_occur>=0){var start=first_occur-20,end=first_occur+80;start<0&&(start=0),0==start&&(end=50),end>content.length&&(end=content.length);var match_content=content.substring(start,end);keywords.forEach(function(keyword){var regS=new RegExp(keyword,"gi");match_content=match_content.replace(regS,'<b class="search-keyword">'+keyword+"</b>")}),str+='<p class="search-result">'+match_content+"...</p>"}str+="</li>"}}),str+="</ul>",0==matchcounts&&(str='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==keywords&&(str='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),$resultContent.innerHTML=str}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(){$popup.hide(),$(".popoverlay").remove(),$("body").css({overflow:"",paddingRight:""})}),$popup.click(function(e){e.stopPropagation()}),$(window).on("resize",function(){popopConH()});